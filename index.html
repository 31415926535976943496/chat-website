<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>登入聊天室</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: sans-serif; margin: 0; background: #f0f0f0; }
    #loginPage, #chatPage { display: none; height: 100vh; justify-content: center; align-items: center; }
    #loginPage.active, #chatPage.active { display: flex; flex-direction: column; }

    #loginForm, #msgForm { display: flex; flex-direction: column; gap: 10px; }
    input, button { padding: 10px; font-size: 1em; }

    #chatBox { flex: 1; overflow-y: auto; padding: 10px; border: 1px solid #ccc; width: 100%; max-height: 300px; background: #fff; }
  </style>
</head>
<body>

  <!-- 登入介面 -->
  <div id="loginPage" class="active">
    <form id="loginForm">
      <h2>登入聊天室</h2>
      <input type="text" id="username" placeholder="輸入暱稱或帳號" required />
      <input type="password" id="password" placeholder="輸入密碼（管理員用）" />
      <button type="submit">登入</button>
    </form>
  </div>

  <!-- 聊天介面 -->
  <div id="chatPage">
    <h2 id="welcomeText"></h2>
    <div id="chatBox"></div>
    <form id="msgForm">
      <input id="msgInput" placeholder="輸入訊息..." autocomplete="off" required />
      <button>送出</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const loginPage = document.getElementById('loginPage');
    const chatPage = document.getElementById('chatPage');
    const loginForm = document.getElementById('loginForm');
    const msgForm = document.getElementById('msgForm');
    const msgInput = document.getElementById('msgInput');
    const chatBox = document.getElementById('chatBox');
    const welcomeText = document.getElementById('welcomeText');

    const socket = io();
    let currentUser = '';

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username) return;

      // 管理員登入判斷
      if (username === 'admin' && password === '123456') {
        currentUser = '管理員';
      } else if (username === 'admin') {
        alert('管理員密碼錯誤');
        return;
      } else {
        currentUser = username;
      }

      loginPage.classList.remove('active');
      chatPage.classList.add('active');

      welcomeText.textContent = `歡迎進入聊天室，${currentUser}`;
      socket.emit('join', currentUser);
    });

    msgForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = msgInput.value.trim();
      if (text) {
        socket.emit('chat message', text);
        msgInput.value = '';
      }
    });

    socket.on('chat message', (data) => {
      const div = document.createElement('div');
      div.textContent = `${data.name}: ${data.msg}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on('system', (msg) => {
      const div = document.createElement('div');
      div.textContent = msg;
      div.style.color = 'gray';
      chatBox.appendChild(div);
    });
  </script>

</body>
</html>
